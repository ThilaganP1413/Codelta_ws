<?xml version="1.0" ?>
<sdf version="1.7">
  <world name="biglide_world">

    <physics name="1ms" type="ignored">
      <max_step_size>0.001</max_step_size>
      <real_time_factor>1.0</real_time_factor>
    </physics>
    <plugin
      filename="ignition-gazebo-physics-system"
      name="gz::sim::systems::Physics">
    </plugin>
    <plugin
      filename="ignition-gazebo-user-commands-system"
      name="gz::sim::systems::UserCommands">
    </plugin>
    <plugin
      filename="ignition-gazebo-scene-broadcaster-system"
      name="gz::sim::systems::SceneBroadcaster">
    </plugin>

    <light type="directional" name="sun">
      <cast_shadows>true</cast_shadows>
      <pose>0 0 10 0 0 0</pose>
      <diffuse>1 1 1 1</diffuse>
      <specular>0.5 0.5 0.5 1</specular>
      <attenuation>
        <range>1000</range>
        <constant>0.9</constant>
        <linear>0.01</linear>
        <quadratic>0.001</quadratic>
      </attenuation>
      <direction>-0.5 0.1 -0.9</direction>
    </light>

    <model name="ground_plane">
      <static>true</static>
      <link name="link">
        <collision name="collision">
          <geometry>
            <plane>
              <normal>0 0 1</normal>
              <size>100 100</size>
            </plane>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <plane>
              <normal>0 0 1</normal>
              <size>100 100</size>
            </plane>
          </geometry>
          <material>
            <ambient>0.8 0.8 0.8 1</ambient>
            <diffuse>0.8 0.8 0.8 1</diffuse>
            <specular>0.8 0.8 0.8 1</specular>
          </material>
        </visual>
      </link>
    </model>

    <model name="biglide">
      <pose>0 0 0.0  0 0 0</pose>
      <self_collide>false</self_collide>
      <link name="leftRail">
        <pose>0 0 0  0 0 0</pose>
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>1e-5</ixx>
            <iyy>1e-5</iyy>
            <izz>1e-5</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <gravity>0</gravity>
        <visual name="leftRailVisual">
          <geometry>
            <box>
              <size>0.01 5.0 0.01</size>
            </box>
          </geometry>
        </visual>
      </link>
      <link name="rightRail">
        <pose>0.4 0 0  0 0 0</pose>
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>1e-5</ixx>
            <iyy>1e-5</iyy>
            <izz>1e-5</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <gravity>0</gravity>
        <visual name="rightRailVisual">
          <geometry>
            <box>
              <size>0.01 5.0 0.01</size>
            </box>
          </geometry>
        </visual>
      </link>
      <link name="leftFoot">
        <pose>0 0 0  0 0 0</pose>
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>1e-5</ixx>
            <iyy>1e-5</iyy>
            <izz>1e-5</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <gravity>0</gravity>
        <visual name="leftBoxVisual">
          <geometry>
            <box>
              <size>0.05 0.15 0.05</size>
            </box>
          </geometry>
        </visual>
      </link>
      <link name="rightFoot">
        <pose>0.4 0 0  0 0 0</pose>
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>1e-5</ixx>
            <iyy>1e-5</iyy>
            <izz>1e-5</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <gravity>0</gravity>
        <visual name="rightBoxVisual">
          <geometry>
            <box>
              <size>0.05 0.15 0.05</size>
            </box>
          </geometry>
        </visual>
      </link>
      <link name="leftArm">
        <pose>0.0 0.0 0  0 0 0.7853981</pose>
        <inertial>
          <pose>0.2828427 0.0 0  0 0 0.0</pose>
          <mass>1.0</mass>
          <inertia>
            <ixx>1e-5</ixx>
            <iyy>1e-5</iyy>
            <izz>1e-5</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <gravity>0</gravity>
        <visual name="leftArmVisual">
          <pose>0.14142135623 0.0 0  0 0 0.0</pose>
          <geometry>
            <box>
              <size>0.2828427 0.05 0.05</size>
            </box>
          </geometry>
        </visual>
      </link>
      <link name="rightArm">
        <pose>0.4 0.0 0 0 0 2.3561949</pose>
        <inertial>
          <pose>0.2828427 0.0 0  0 0 0.0</pose>
          <mass>1.0</mass>
          <inertia>
            <ixx>1e-5</ixx>
            <iyy>1e-5</iyy>
            <izz>1e-5</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <gravity>0</gravity>
        <visual name="rightArmVisual">
          <pose>0.14142135623 0.0 0 0 0 0.0 </pose>
          <geometry>
            <box>
              <size>0.2828427 0.05 0.05</size>
            </box>
          </geometry>
        </visual>
      </link>
      <link name="endEffector">
        <pose>0.2 0.2 0  0 0 0</pose>
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>1e-5</ixx>
            <iyy>1e-5</iyy>
            <izz>1e-5</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <gravity>0</gravity>
        <visual name="endEffectorVisual">
          <geometry>
            <cylinder>
              <radius>0.05</radius>
              <length>0.05</length>
            </cylinder>
          </geometry>
        </visual>
      </link>
      <joint name="jointLeftRail" type="fixed">
        <pose>0 0 0 0 0 0</pose>
        <parent>world</parent>
        <child>leftRail</child>
      </joint>
      <joint name="A11" type="prismatic">
        <pose>0 0 0 0 0 0</pose>
        <parent>leftRail</parent>
        <child>leftFoot</child>
        <axis>
          <xyz>0 1 0</xyz>
          <limit>
          <lower>-1</lower>
          <upper>1</upper>
        </limit>
        </axis>

      </joint>
      <joint name="A21" type="prismatic">
        <pose>0 0 0 0 0 0</pose>
        <parent>rightFoot</parent>
        <child>rightRail</child>
        <axis>
          <xyz>0 1 0</xyz>
          <limit>
          <lower>-1</lower>
          <upper>1</upper>
        </limit>
        </axis>

      </joint>
      <joint name="A12" type="revolute">
        <pose>0 0 0 0 0 0</pose>
        <parent>leftFoot</parent>
        <child>leftArm</child>
        <axis>
          <xyz>0 0 1</xyz>
        </axis>
      </joint>
      <joint name="A22" type="revolute">
        <pose>0.0 0 0 0 0 0</pose>
        <parent>rightArm</parent>
        <child>rightFoot</child>
        <axis>
          <xyz>0 0 1</xyz>
        </axis>
      </joint>
      <joint name="A13" type="revolute">
        <parent>endEffector</parent>
        <child>rightArm</child>
        <pose>0 0 0 0 0 0</pose>
        <axis>
          <xyz>0 0 1</xyz>
        </axis>
      </joint>
      <joint name="jointEndEffector" type="fixed">
        <parent>leftArm</parent>
        <child>endEffector</child>
      </joint>

      <!-- this one below is changed to a plugin -->
      <!--joint name="jointRightRail" type="fixed">
        <pose>0 0 0 0 0 0</pose>
        <parent>world</parent>
        <child>rightRail</child>
      </joint-->

      <link name="rightRailDummy"/>

      <joint name="rightRailJoint" type="fixed">
        <parent>world</parent>
        <child>rightRailDummy</child>
      </joint>

      <!-- custom plugin, simpler but custom -->
      <!--plugin filename="libattach-links.so" name="gz::sim::systems::AttachLinks">
        <parent>rightRailDummy</parent>
        <child>rightRail</child>
      </plugin-->

      <!-- existing plugin, hope this model is spawned under this name -->
      <plugin filename="ignition-gazebo-detachable-joint-system"
              name="ignition::gazebo::systems::DetachableJoint">
        <parent_link>rightRailDummy</parent_link>
        <child_model>biglide</child_model>
        <child_link>rightRail</child_link>
        <attach_topic>/close_loop</attach_topic>
        <detach_topic>/open_loop</detach_topic>
        <output_topic>/loop_state</output_topic>
      </plugin>

      <!-- <plugin filename="libignition-gazebo-imu-system.so"
          name="ignition::gazebo::systems::Imu">
      </plugin>

      <plugin filename="ignition-gazebo-joint-state-publisher-system" 
            name="ignition::gazebo::systems::JointStatePublisher"/> -->

      <plugin filename="ignition-gazebo-apply-joint-force-system"
              name="gz::sim::systems::ApplyJointForce">
        <joint_name>A11</joint_name>
      </plugin>

      <plugin filename="ignition-gazebo-apply-joint-force-system"
              name="gz::sim::systems::ApplyJointForce">
        <joint_name>A21</joint_name>
      </plugin>
    </model>
  </world>
</sdf>